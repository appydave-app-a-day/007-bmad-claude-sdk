# Story 1.4 - Acceptance Test Guide

## Quick Summary

**Story**: Implement Socket.io for Real-Time Client-Server Communication
**Status**: Ready for Review (Implementation complete - ready for testing)
**Test Focus**: Real-time bidirectional Socket.io communication between browser client and Express server

---

## Prerequisites

**Before testing, ensure:**
- [x] Story 1.4 status is "Ready for Review" ‚úÖ
- [x] Story 1.3 completed (HTML client exists at `/chat` route) ‚úÖ
- [ ] Server is not running (to test fresh startup)
- [x] Dependencies installed: `npm install` at root ‚úÖ
- [ ] No other process using port 3000

**Environment Setup:**
- Node.js: 18+ (check with `node --version`)
- Port: 3000 (server)
- Working directory: Project root (`007-bmad-claude-sdk/`)
- Browser: Chrome or Firefox (for console inspection)

**Quick Pre-Test Validation:**
```bash
# Verify dependencies installed
npm list socket.io concurrently
# Note: socket.io-client uses CDN (no npm package needed)
```

---

## üßë Human Tests (Visual/Manual)

Tests requiring human observation - browser, UI, colors, interactive behavior.

### Test 1: AC7 - Socket.io connection established (console logging)

**What to test**: Console logging shows Socket.io connection established

**Steps**:
1. Open terminal in project root
2. Run `npm run dev`
3. Observe terminal output for both server and client workspaces
4. Open browser to `http://localhost:3000/chat`
5. Open browser DevTools Console (F12 ‚Üí Console tab)
6. Observe console messages

**Expected Result**:
‚úÖ **Terminal shows:**
- Server workspace output with colored logs
- `[Socket] Socket connected { id: '[socket-id]' }` message
- Blue/green colored timestamp and component labels

‚úÖ **Browser console shows:**
- `Connected to server with ID: [socket-id]`
- Socket ID is a unique string (e.g., `abc123XYZ`)

**Evidence**:
- Terminal screenshot showing Socket connection log
- Browser console screenshot showing connection message
- Connection status indicator in UI shows "‚úÖ Connected" in green

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 2: AC8 - Manual test (type message, server echoes back)

**What to test**: Type message in client, server echoes back via Socket.io (proves real-time communication)

**Steps**:
1. Ensure server running from Test 1 (`npm run dev`)
2. Navigate to `http://localhost:3000/chat` in browser
3. Locate text input field (placeholder: "Enter a message (optional)")
4. Type test message: `Hello Socket.io`
5. Click "Send via Socket.io" button
6. Observe response display area on page
7. Observe browser console (F12 ‚Üí Console)
8. Observe terminal server logs

**Expected Result**:
‚úÖ **Browser UI shows:**
- Response area displays: `Server received: "Hello Socket.io"`
- Timestamp displayed below message (local time format)
- Message appears instantly (< 100ms)

‚úÖ **Browser console shows:**
- `Emitting test_message: Hello Socket.io`
- `Received test_response: { message: '...', timestamp: 1234567890 }`

‚úÖ **Terminal shows:**
- `[Socket] Received test_message { data: { message: 'Hello Socket.io' } }`
- Timestamp matches response timestamp

**Evidence**:
- Screenshot of browser showing echoed message
- Screenshot of browser console showing sent/received events
- Screenshot of terminal showing server log

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 3: AC9 - Disconnection error handling (user-visible message)

**What to test**: Error handling for Socket disconnection with user-visible message

**Steps**:
1. Ensure server running and client connected (Test 1 + 2 passed)
2. Browser still open at `http://localhost:3000/chat`
3. In terminal, press `Ctrl+C` to stop server
4. Observe browser UI immediately
5. Observe browser console
6. Wait 5 seconds
7. Restart server: `npm run dev`
8. Observe browser UI for reconnection

**Expected Result**:
‚úÖ **Browser UI on disconnection:**
- Connection status changes to "‚ùå Disconnected - Waiting for server..." in red text
- Response output area shows: "Connection lost. Please check if server is running."
- Response area has red background (`#ffe6e6`) and red border

‚úÖ **Browser console on disconnection:**
- `Disconnected from server at [ISO timestamp]`
- Timestamp in format: `2025-11-14T10:30:45.123Z`

‚úÖ **Browser UI on reconnection:**
- Connection status changes back to "‚úÖ Connected" in green
- Response area background returns to light gray (`#f5f5f5`)
- Red border removed
- New socket ID logged in console

**Evidence**:
- Screenshot of disconnection UI (red status, red response area)
- Screenshot of browser console showing disconnect timestamp
- Screenshot of reconnection UI (green status, normal styling)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 4: AC11 - Single command starts both server and client

**What to test**: Single command `npm run dev` starts both server and client

**Steps**:
1. Ensure server is stopped (Ctrl+C if running)
2. Run `npm run dev` in project root
3. Observe terminal output
4. Look for two distinct workspace outputs (server + client)
5. Verify both workspaces are running concurrently

**Expected Result**:
‚úÖ **Terminal shows:**
- Colored output with workspace labels: `[@bmad-app/server]`, `[@bmad-app/client]`
- Server output: `[Server] Server listening on port 3000`
- Server output: `[Server] Test client: http://localhost:3000/chat`
- Client output: Shows client dev server started (if applicable)
- Both processes running simultaneously (not sequentially)

‚úÖ **Concurrently behavior:**
- Single Ctrl+C stops both processes gracefully
- Output clearly distinguishes which workspace is logging

**Evidence**:
- Terminal screenshot showing both workspaces running
- Different colored output for server vs client (if configured)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 5: AC12 - Hot reload (server restart on code change)

**What to test**: Hot reload works - changing server code restarts server

**Steps**:
1. Ensure `npm run dev` is running
2. Browser open at `http://localhost:3000/chat` (stay connected)
3. Open `packages/server/src/server.ts` in code editor
4. Find logger message: `logger.info('Socket connected', { id: socket.id })`
5. Change to: `logger.info('Socket CONNECTED!!!', { id: socket.id })`
6. Save file
7. Observe terminal (server should restart)
8. Observe browser (should show disconnection briefly)
9. Refresh browser or wait for auto-reconnection
10. Open browser console
11. Verify new connection logs show updated message

**Expected Result**:
‚úÖ **Terminal shows:**
- `[Server] Detected file change: packages/server/src/server.ts`
- `[Server] Restarting server...`
- Server restarts with new log message

‚úÖ **Browser behavior:**
- Socket disconnects briefly (red status indicator)
- Auto-reconnects after ~1-2 seconds (green status)
- Console shows new socket ID

‚úÖ **Server terminal shows updated log:**
- `[Socket] Socket CONNECTED!!! { id: '[new-socket-id]' }`

**Evidence**:
- Screenshot of modified server.ts file
- Terminal screenshot showing server restart
- Browser console showing new connection with updated log

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 6: AC12 - Hot reload (client refresh on HTML change)

**What to test**: Hot reload works - changing client code rebuilds client

**Steps**:
1. Ensure `npm run dev` is running
2. Browser open at `http://localhost:3000/chat`
3. Open `packages/client/index.html` in code editor
4. Find `<h1>Socket.io Communication Test</h1>`
5. Change to: `<h1>Socket.io TEST - Updated!</h1>`
6. Save file
7. Manually refresh browser (`Cmd+R` or `F5`)
8. Observe page title changed

**Expected Result**:
‚úÖ **Browser shows:**
- Page header now reads: "Socket.io TEST - Updated!"
- Socket connection still works (green status)
- Form still functional (can send test messages)

‚úÖ **Terminal shows:**
- Client workspace may show file change detection
- No server restart (server unaffected by client changes)

**Evidence**:
- Screenshot of modified index.html file
- Browser screenshot showing updated header
- Socket still connected (green status indicator)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

## ü§ñ Terminal Tests (Scriptable)

Tests using command-line tools - copy-paste ready commands.

### Test A: AC1 - Socket.io dependencies installed

**What to test**: Socket.io installed in server workspace and client uses CDN

**Command**:
```bash
# Check server dependency
grep "socket.io" packages/server/package.json

# Check client uses CDN (not npm package)
grep "cdn.socket.io" packages/client/index.html

# Check concurrently dependency
grep "concurrently" package.json
```

**Expected Output**:
```
# Server output:
"socket.io": "^4.8.1"

# Client output (CDN in HTML):
<script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>

# Root output:
"concurrently": "^9.1.0"
```

**Validation**:
- ‚úÖ `socket.io` version 4.8.1 in server package.json
- ‚úÖ Socket.io-client loaded via CDN (4.8.1) in index.html - no npm package needed
- ‚úÖ `concurrently` version 9.1.0 in root package.json
- ‚úÖ Server and client use same Socket.io version (4.8.1)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test B: AC2 - Socket.io server initialized in Express app

**What to test**: Socket.io server initialized in Express app

**Command**:
```bash
# Check for Socket.io imports and initialization
grep -A 5 "import.*socket.io" packages/server/src/server.ts
grep "new Server" packages/server/src/server.ts
grep "httpServer.listen" packages/server/src/server.ts
```

**Expected Output**:
```typescript
import { Server } from 'socket.io';
// ... other imports

const io = new Server(httpServer, {
  cors: {
    origin: 'http://localhost:5173',
    methods: ['GET', 'POST']
  }
});

httpServer.listen(3000, () => {
```

**Validation**:
- ‚úÖ Socket.io Server imported from 'socket.io'
- ‚úÖ `new Server(httpServer, {...})` initialization exists
- ‚úÖ CORS configuration includes `localhost:5173`
- ‚úÖ Uses `httpServer.listen()` instead of `app.listen()`

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test C: AC3 - Client HTML updated with Socket.io client library

**What to test**: Client HTML updated with Socket.io client library

**Command**:
```bash
# Check for Socket.io CDN script tag
grep "cdn.socket.io" packages/client/index.html

# Check for Socket.io client initialization
grep "io('http://localhost:3000')" packages/client/index.html
```

**Expected Output**:
```html
<script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>

const socket = io('http://localhost:3000');
```

**Validation**:
- ‚úÖ Socket.io CDN script tag present (version 4.8.1 or higher 4.x)
- ‚úÖ Socket client initialized with `io('http://localhost:3000')`
- ‚úÖ CDN URL is HTTPS (secure)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test D: AC4+5 - Socket events (test_message and test_response)

**What to test**: Socket event handlers exist for test_message and test_response

**Command**:
```bash
# Check server has test_message listener
grep -A 3 "socket.on.*test_message" packages/server/src/server.ts

# Check server emits test_response
grep "socket.emit.*test_response" packages/server/src/server.ts

# Check client emits test_message
grep "socket.emit.*test_message" packages/client/index.html

# Check client listens for test_response
grep -A 2 "socket.on.*test_response" packages/client/index.html
```

**Expected Output**:
```typescript
// Server:
socket.on('test_message', (data) => {
  logger.info('Received test_message', { data });
  socket.emit('test_response', {
    message: `Server received: "${data.message}"`,
    timestamp: Date.now()
  });
});

// Client:
socket.emit('test_message', { message });
socket.on('test_response', (data) => {
  console.log('Received test_response:', data);
});
```

**Validation**:
- ‚úÖ Server listens for `test_message` event
- ‚úÖ Server emits `test_response` with message and timestamp
- ‚úÖ Client emits `test_message` with message data
- ‚úÖ Client listens for `test_response` event

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test E: AC10 - README.md documents Socket.io setup

**What to test**: README.md documents Socket.io setup and test procedure

**Command**:
```bash
# Check README.md exists
ls -la README.md

# Check for Socket.io section
grep -i "socket.io" README.md

# Check for test procedure
grep -i "test" README.md
```

**Expected Output**:
```
-rw-r--r-- 1 user staff 5432 Nov 14 10:30 README.md

# Socket.io Real-Time Communication
[... documentation content ...]

## Testing
[... test procedure content ...]
```

**Validation**:
- ‚úÖ README.md file exists at project root
- ‚úÖ Contains "Socket.io" section or heading
- ‚úÖ Documents test procedure (how to test the connection)
- ‚úÖ Mentions test events: `test_message`, `test_response`

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test F: AC11 - Root package.json has dev scripts

**What to test**: Root package.json has concurrently dev scripts configured

**Command**:
```bash
# Check dev script exists
grep -A 4 '"scripts"' package.json | grep "dev"
```

**Expected Output**:
```json
"dev": "concurrently \"npm:dev:server\" \"npm:dev:client\"",
"dev:server": "npm run dev --workspace=@bmad-app/server",
"dev:client": "npm run dev --workspace=@bmad-app/client",
```

**Validation**:
- ‚úÖ `dev` script uses `concurrently` command
- ‚úÖ `dev:server` script runs server workspace
- ‚úÖ `dev:client` script runs client workspace
- ‚úÖ Uses named scripts pattern: `npm:dev:server` syntax

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test G: AC13 - TypeScript compilation zero errors

**What to test**: TypeScript compilation has zero errors across all workspaces

**Command**:
```bash
npm run build
```

**Expected Output**:
```
> @bmad-app/server:build
> tsc

> @bmad-app/client:build
> tsc

> @bmad-app/shared:build
> tsc
```

**Validation**:
- ‚úÖ Build command completes successfully
- ‚úÖ No TypeScript errors in any workspace
- ‚úÖ All workspaces compile without warnings
- ‚úÖ Exit code 0 (success)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

## ‚è≥ Not Testable Yet

**AC6 (Partial)**: Client receives test_response and displays in console **or on page**
- **Testable**: Console display (covered in Test 2)
- **Testable**: Page display (covered in Test 2)
- **Note**: Both console AND page display are testable now - AC fully covered

**No acceptance criteria deferred to future stories.**

---

## Test Checklist

Copy this checklist to track overall progress:

**Human Tests:**
- [ ] Test 1: Socket.io connection established (console logging) - AC7
- [ ] Test 2: Manual echo test (type message, server responds) - AC8
- [ ] Test 3: Disconnection error handling (user-visible message) - AC9
- [ ] Test 4: Single command starts both workspaces - AC11
- [ ] Test 5: Hot reload (server code change restarts server) - AC12
- [ ] Test 6: Hot reload (client HTML change requires refresh) - AC12

**Terminal Tests:**
- [ ] Test A: Socket.io dependencies installed - AC1
- [ ] Test B: Socket.io server initialized in Express - AC2
- [ ] Test C: Client HTML has Socket.io client library - AC3
- [ ] Test D: Socket event handlers (test_message/test_response) - AC4, AC5
- [ ] Test E: README.md documents Socket.io setup - AC10
- [ ] Test F: Root package.json has dev scripts - AC11
- [ ] Test G: TypeScript compilation zero errors - AC13

**Overall Status**: ‚¨ú Not Started | üîÑ In Progress | ‚úÖ All Passed | ‚ùå Issues Found

---

## Troubleshooting

### Issue: Port 3000 already in use
**Symptom**: `Error: listen EADDRINUSE: address already in use :::3000`
**Solution**:
1. Find process using port 3000: `lsof -i :3000`
2. Kill process: `kill -9 [PID]`
3. Or change port in server.ts (update to 3001) and retest

### Issue: Socket.io client not connecting
**Symptom**: Browser console shows "WebSocket connection failed" or infinite reconnection attempts
**Solution**:
1. Verify server is running: Check terminal for `Server listening on port 3000`
2. Verify correct URL: Client should use `http://localhost:3000` (not https)
3. Check browser network tab (F12 ‚Üí Network) for WebSocket upgrade request
4. Verify CORS configured correctly in Socket.io server

### Issue: Disconnection message doesn't appear
**Symptom**: Stopping server doesn't show red disconnection UI
**Solution**:
1. Check browser console for `disconnect` event firing
2. Verify `socket.on('disconnect', ...)` handler exists in client HTML
3. Check CSS styles applied (red background, red border)
4. Hard refresh browser (Cmd+Shift+R / Ctrl+Shift+F5)

### Issue: Hot reload not working for server
**Symptom**: Changing server.ts doesn't restart server
**Solution**:
1. Verify `tsx --watch` is running (check package.json dev script)
2. Ensure file saved (Cmd+S / Ctrl+S)
3. Check terminal for file change detection logs
4. Restart `npm run dev` manually

### Issue: Concurrently not starting both workspaces
**Symptom**: Only one workspace starts, or command fails
**Solution**:
1. Verify concurrently installed: `npm list concurrently`
2. Check root package.json scripts syntax (double quotes escaped correctly)
3. Run workspaces individually: `npm run dev:server` and `npm run dev:client` separately
4. Check for errors in workspace package.json dev scripts

### Issue: Browser console shows "io is not defined"
**Symptom**: `ReferenceError: io is not defined` in browser console
**Solution**:
1. Verify Socket.io CDN script tag loads BEFORE inline script
2. Check browser Network tab (F12 ‚Üí Network) - CDN script should load successfully
3. Check CDN URL is correct: `https://cdn.socket.io/4.8.1/socket.io.min.js`
4. Try different CDN version if current version fails to load

---

## Test Results Summary

**Date Tested**: _________________
**Tester**: _________________

**Results**:
- Human Tests: __ / 6 passed
- Terminal Tests: __ / 7 passed
- Total: __ / 13 passed

**Issues Found**:
1. _______________________________________
2. _______________________________________
3. _______________________________________

**Sign-off**: ‚¨ú Story accepted | ‚¨ú Issues require fixes | ‚¨ú Ready for testing

**Notes**:
_______________________________________________________________________________
_______________________________________________________________________________
_______________________________________________________________________________

---

*Generated by Taylor (SAT Guide Creator) from Story 1.4*
*Story Status: Ready for Review - Implementation complete, ready for manual testing*
*SAT Guide Version: 1.1 - Updated after implementation*
*Created: 2025-11-14 | Updated: 2025-11-14*
