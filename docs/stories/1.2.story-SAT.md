# Story 1.2 - Acceptance Test Guide

## Quick Summary

**Story**: Create Express TypeScript Server
**Status**: Complete
**Test Focus**: Validate Express TypeScript server with health check endpoint, structured logging, error handling, and hot reload development environment.

## Prerequisites

**Before testing, ensure:**
- [ ] Story status is "Complete"
- [ ] Server is not running (stop any previous instances)
- [ ] Dependencies installed (`npm install` at project root)
- [ ] Terminal supports ANSI colors (for log color validation)

**Environment Setup:**
- Node.js: 18+
- Port: 3000 (default) or set via `PORT` environment variable
- Working directory: Project root (`007-bmad-claude-sdk/`)

---

## üßë Human Tests (Visual/Manual)

Tests requiring human observation - browser, UI, colors, interactive behavior.

### Test 1: AC10 - Server logs startup message with colors

**What to test**: Server logs startup message with port number using logger utility with color-coded output

**Steps**:
1. Run `npm run dev --workspace=@bmad-app/server`
2. Observe terminal output immediately after server starts
3. Note the color of log messages (should be blue)

**Expected Result**:
‚úÖ Terminal shows colored log messages:
- Blue colored timestamp in ISO 8601 format (e.g., `[2025-11-14T12:52:27.836Z]`)
- Blue colored `[Server] Server started on port 3000` message
- Blue colored `[Server] Health check: http://localhost:3000/api/health` message
- No errors or warnings displayed

**Evidence**:
- Terminal screenshot showing blue colored logs
- Timestamp follows format: `[YYYY-MM-DDTHH:MM:SS.sssZ]`
- Component prefix present: `[Server]`

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 2: AC4 - Health check endpoint in browser

**What to test**: Health check route `/api/health` returns `{ status: 'ok' }` JSON response

**Steps**:
1. Ensure server is running (from Test 1)
2. Open browser (Chrome/Firefox/Safari)
3. Navigate to `http://localhost:3000/api/health`
4. Observe the JSON response displayed

**Expected Result**:
‚úÖ Browser displays JSON response:
- Page shows: `{"status":"ok"}`
- Content-Type header is `application/json`
- No errors in browser console (F12 ‚Üí Console tab)
- Status code 200 OK (visible in browser dev tools Network tab)

**Evidence**:
- Browser screenshot showing JSON response
- Network tab showing 200 OK status

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 3: AC12 - 404 handler returns JSON error in browser

**What to test**: Server returns JSON error for non-existent routes

**Steps**:
1. Ensure server is running
2. Open browser to `http://localhost:3000/nonexistent`
3. Observe the JSON error response

**Expected Result**:
‚úÖ Browser displays JSON error:
- Page shows: `{"error":"Not found"}`
- Status code 404 (visible in Network tab)
- Content-Type is `application/json`
- No server crash (terminal still shows running server)

**Evidence**:
- Browser screenshot showing error JSON
- Network tab showing 404 status

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 4: AC7 - Hot reload with tsx watch mode

**What to test**: Development script uses tsx watch mode for auto-restart on file changes

**Steps**:
1. Ensure server is running via `npm run dev --workspace=@bmad-app/server`
2. Note the current terminal output
3. Edit `packages/server/src/server.ts` - change startup message (e.g., add "successfully" to the message)
4. Save the file
5. Observe terminal output

**Expected Result**:
‚úÖ Server automatically restarts:
- Terminal shows `[tsx] change in ./src/server.ts Restarting...` message
- Server restarts within 2-3 seconds
- New startup message appears with your change
- Server continues running (no crash)
- Health endpoint still accessible after restart

**Evidence**:
- Terminal screenshot showing restart message
- Restarted server with modified log message

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test 5: AC8 - Logger color-coded output for different levels

**What to test**: Logging utility with color-coded output (info=blue, warn=yellow, error=red, debug=gray)

**Steps**:
1. Server should be running
2. Observe terminal showing blue info logs (from startup)
3. To test other colors, you would need to trigger warn/error logs (not part of current story behavior)

**Expected Result**:
‚úÖ Logger displays colors correctly:
- Info logs display in blue (observed in startup messages)
- Structured format present: `[timestamp] [component] message`
- Timestamp is ISO 8601 format
- Component prefix shows `[Server]`

**Evidence**:
- Terminal screenshot showing blue info logs
- Format matches: `[2025-11-14T12:52:27.836Z] [Server] Server started on port 3000`

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: Warn/error/debug colors will be tested when those log levels are triggered in future stories
_________________

---

## ü§ñ Terminal Tests (Scriptable)

Tests using command-line tools - copy-paste ready commands.

### Test A: AC4 - Health check endpoint via curl

**What to test**: Health check route returns correct JSON via HTTP

**Command**:
```bash
curl -s http://localhost:3000/api/health
```

**Expected Output**:
```json
{"status":"ok"}
```

**Validation**:
- ‚úÖ Response is valid JSON
- ‚úÖ Contains `status` field
- ‚úÖ Value is `"ok"` (with quotes)
- ‚úÖ No errors in terminal
- ‚úÖ No HTML or error messages

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test B: AC12 - 404 handler via curl

**What to test**: 404 handler returns JSON error for non-existent routes

**Command**:
```bash
curl -s http://localhost:3000/nonexistent
```

**Expected Output**:
```json
{"error":"Not found"}
```

**Validation**:
- ‚úÖ Response is valid JSON
- ‚úÖ Contains `error` field
- ‚úÖ Value is `"Not found"`
- ‚úÖ No server crash (curl succeeds)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test C: AC6 - TypeScript build compiles successfully

**What to test**: Build script compiles TypeScript to `dist/` directory

**Command**:
```bash
npm run build --workspace=@bmad-app/server
```

**Expected Output**:
```
> @bmad-app/server@1.0.0 build
> tsc
```
(No error messages)

**Validation**:
- ‚úÖ Command exits with code 0 (success)
- ‚úÖ No TypeScript errors displayed
- ‚úÖ `dist/` directory created in `packages/server/`
- ‚úÖ Contains `.js`, `.d.ts`, `.js.map` files

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test D: AC6 - Verify dist/ directory contents

**What to test**: Build generates JavaScript, type definitions, and source maps

**Command**:
```bash
ls -R packages/server/dist/
```

**Expected Output**:
```
packages/server/dist/:
routes  server.d.ts  server.d.ts.map  server.js  server.js.map  utils

packages/server/dist/routes:
health.d.ts  health.d.ts.map  health.js  health.js.map

packages/server/dist/utils:
errors.d.ts  errors.d.ts.map  errors.js  errors.js.map  logger.d.ts  logger.d.ts.map  logger.js  logger.js.map
```

**Validation**:
- ‚úÖ `server.js` exists (compiled entry point)
- ‚úÖ `server.d.ts` exists (type definitions)
- ‚úÖ `.js.map` files exist (source maps)
- ‚úÖ `routes/` and `utils/` directories present
- ‚úÖ All 4 source files compiled (server, health, logger, errors)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test E: AC1 - Express 5 installed correctly

**What to test**: Express 5 installed in server workspace

**Command**:
```bash
grep '"express"' packages/server/package.json
```

**Expected Output**:
```
    "express": "^5.0.1"
```

**Validation**:
- ‚úÖ Express is listed in dependencies (not devDependencies)
- ‚úÖ Version is 5.x (specifically ^5.0.1 or higher)
- ‚úÖ Correct package name (not @types/express)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test F: AC1 - TypeScript dependencies installed

**What to test**: @types/express and tsx installed in devDependencies

**Command**:
```bash
grep -E '"@types/express"|"tsx"' packages/server/package.json
```

**Expected Output**:
```
    "@types/express": "^5.0.0",
    "tsx": "^4.19.2"
```

**Validation**:
- ‚úÖ @types/express present in devDependencies
- ‚úÖ tsx present in devDependencies
- ‚úÖ Versions match requirements (Express 5 types, tsx 4.x)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test G: AC5 - TypeScript configuration extends root config

**What to test**: Server tsconfig.json extends root configuration

**Command**:
```bash
grep '"extends"' packages/server/tsconfig.json
```

**Expected Output**:
```
  "extends": "../../tsconfig.json",
```

**Validation**:
- ‚úÖ Extends property points to root tsconfig.json
- ‚úÖ Path is relative (`../../`)
- ‚úÖ CommonJS module configured (check full file if needed)

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

### Test H: AC7 - Package scripts configured

**What to test**: Package.json contains required scripts (dev, build, start)

**Command**:
```bash
grep -A 5 '"scripts"' packages/server/package.json
```

**Expected Output**:
```
  "scripts": {
    "dev": "tsx watch src/server.ts",
    "build": "tsc",
    "start": "node dist/server.js",
    "clean": "rm -rf dist node_modules"
  },
```

**Validation**:
- ‚úÖ `dev` script uses tsx watch
- ‚úÖ `build` script runs tsc
- ‚úÖ `start` script runs compiled JavaScript
- ‚úÖ All required scripts present

**Status**: ‚¨ú Not Tested | ‚úÖ Passed | ‚ùå Failed

**Notes**: _________________

---

## ‚è≥ Not Testable Yet

**AC11**: CORS configured to allow requests from Vite dev server (localhost:5173)
**Reason**: Requires Story 3.1 (React Vite client) to verify CORS headers in browser
**When**: Story 3.1 will enable cross-origin request testing

---

## Test Checklist

Copy this checklist to track overall progress:

**Human Tests:**
- [ ] Test 1: Server startup logs with colors (AC10)
- [ ] Test 2: Health check in browser (AC4)
- [ ] Test 3: 404 handler in browser (AC12)
- [ ] Test 4: Hot reload functionality (AC7)
- [ ] Test 5: Logger color output (AC8)

**Terminal Tests:**
- [ ] Test A: Health check via curl (AC4)
- [ ] Test B: 404 handler via curl (AC12)
- [ ] Test C: TypeScript build (AC6)
- [ ] Test D: Dist directory contents (AC6)
- [ ] Test E: Express 5 installed (AC1)
- [ ] Test F: TypeScript deps installed (AC1)
- [ ] Test G: tsconfig extends root (AC5)
- [ ] Test H: Package scripts (AC7)

**Not Testable:**
- [ ] CORS configuration (AC11) - awaiting Story 3.1

**Overall Status**: ‚¨ú Not Started | üîÑ In Progress | ‚úÖ All Passed | ‚ùå Issues Found

---

## Troubleshooting

### Issue: Server won't start - "Port 3000 already in use"
**Symptom**: Error message `EADDRINUSE: address already in use :::3000`
**Solution**:
1. Kill existing process: `lsof -ti:3000 | xargs kill -9`
2. Or use different port: `PORT=3001 npm run dev --workspace=@bmad-app/server`

### Issue: Colors not showing in terminal
**Symptom**: See ANSI codes like `\x1b[34m` instead of colors
**Solution**:
- Use terminal that supports ANSI colors (iTerm2, Terminal.app, Windows Terminal)
- On Windows, enable ANSI support or use Windows Terminal

### Issue: TypeScript build fails
**Symptom**: `tsc` reports errors or fails to compile
**Solution**:
1. Run `npm install` at project root
2. Check `node_modules` exists in root and `packages/server/`
3. Verify `tsconfig.json` exists in project root
4. Check error messages for specific type issues

### Issue: Hot reload not working
**Symptom**: File changes don't trigger server restart
**Solution**:
1. Ensure using `npm run dev` (not `npm start`)
2. Verify `tsx` is installed: `npm list tsx`
3. Check file is saved (not just modified)
4. Restart dev server manually if needed

### Issue: Health endpoint returns 404
**Symptom**: curl or browser shows `{"error":"Not found"}` for `/api/health`
**Solution**:
1. Verify server is running (check terminal)
2. Check URL is exactly `http://localhost:3000/api/health` (with `/api/` prefix)
3. Verify port 3000 (or check `PORT` environment variable)

---

## Test Results Summary

**Date Tested**: _________________
**Tester**: _________________

**Results**:
- Human Tests: __ / 5 passed
- Terminal Tests: __ / 8 passed
- Total: __ / 13 passed
- Not Testable: 1 (awaiting Story 3.1)

**Issues Found**:
1. _________________
2. _________________
3. _________________

**Notes**:
_________________________________
_________________________________
_________________________________

**Sign-off**: ‚úÖ Story accepted | ‚ùå Issues require fixes

---

*Generated by Taylor (SAT Guide Creator) from Story 1.2*
